<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ACA System Dashboard</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #1c1c1c;
      color: #e6e6e6;
      margin: 0;
      padding: 0;
    }
    header {
      background: #282828;
      padding: 12px 20px;
      border-bottom: 1px solid #444;
    }
    h1 {
      font-size: 20px;
      margin: 0;
      color: #ffd700;
    }
    .metrics {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 20px;
    }
    .card {
      background: #2e2e2e;
      border-radius: 10px;
      padding: 15px 20px;
      flex: 1 1 300px;
      box-shadow: 0 0 10px #0006;
    }
    .card h2 {
      margin-top: 0;
      font-size: 16px;
      color: #ffa500;
    }
    .progress-bar {
      background: #444;
      border-radius: 5px;
      overflow: hidden;
      height: 16px;
      margin-top: 6px;
    }
    .progress {
      background: #00c853;
      height: 100%;
      transition: width 0.3s ease;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }
    th, td {
      text-align: left;
      padding: 6px;
      border-bottom: 1px solid #444;
    }
    .status {
      font-weight: bold;
    }
    .status.on { color: #00e676; }
    .status.off { color: #ff5252; }
    pre {
      background: #111;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
      max-height: 200px;
      font-size: 12px;
    }
    footer {
      text-align: center;
      font-size: 12px;
      padding: 10px;
      color: #888;
    }
  </style>
</head>
<body>
  <header>
    <h1>Alphine AI — ACA System Dashboard</h1>
  </header>

  <section class="metrics">
    <div class="card" id="system">
      <h2>System Status</h2>
      <p><b>Uptime:</b> <span id="uptime">0</span> s</p>
      <p><b>Platform:</b> <span id="platform">-</span></p>
      <p><b>Node Version:</b> <span id="node">-</span></p>
      <p><b>CPU Load:</b> <span id="cpu">-</span></p>
      <p><b>Memory:</b> <span id="mem">-</span> MB</p>
      <div class="progress-bar"><div id="memBar" class="progress" style="width:0%"></div></div>
    </div>

    <div class="card" id="flags">
      <h2>Runtime Flags</h2>
      <table id="flagsTable">
        <thead><tr><th>Flag</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card" id="logs">
      <h2>Recent Logs</h2>
      <pre id="logTail">Loading...</pre>
    </div>
  </section>

  <footer>
    Alphine AI — Automated Call Attender Monitoring Panel | Story 4.1
  </footer>

  <script>
    async function loadMetrics() {
      try {
        const res = await fetch("/dashboard/system/data");
        const data = await res.json();

        // Uptime & basic info
        document.getElementById("uptime").textContent = data.uptime_sec;
        document.getElementById("platform").textContent = data.platform;
        document.getElementById("node").textContent = data.node_version;
        document.getElementById("cpu").textContent = data.cpu_load.map(n => n.toFixed(2)).join(", ");
        document.getElementById("mem").textContent = data.memory_mb;

        // Memory bar
        const memPercent = Math.min((data.memory_mb / 2048) * 100, 100);
        const bar = document.getElementById("memBar");
        bar.style.width = memPercent + "%";
        bar.style.background = memPercent > 80 ? "#ff3d00" : memPercent > 60 ? "#ff9100" : "#00c853";

        // Runtime Flags
        const tbody = document.querySelector("#flagsTable tbody");
        tbody.innerHTML = "";
        for (const [key, value] of Object.entries(data.flags || {})) {
          const row = document.createElement("tr");
          row.innerHTML = `<td>${key}</td><td class="status ${value ? "on" : "off"}">${value ? "ON" : "OFF"}</td>`;
          tbody.appendChild(row);
        }

        // Logs
        document.getElementById("logTail").textContent = (data.logs || []).join("\n");
      } catch (err) {
        console.error("Dashboard load error:", err);
      }
    }

    loadMetrics();
    setInterval(loadMetrics, 5000); // refresh every 5 s
  </script>
</body>
</html>
