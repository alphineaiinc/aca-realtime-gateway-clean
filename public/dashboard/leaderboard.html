<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Alphine AI â€” Partner Leaderboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Poppins:wght@700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>
<style>
  :root{
    --bg:#0b0e14;--card:rgba(255,255,255,.06);--glass:rgba(255,255,255,.08);
    --text:#eef2ff;--muted:#aab1c9;--accent:#6ee7ff;--gold:#ffd166;--silver:#c0c0c0;--bronze:#cd7f32;
  }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,14,20,.9),rgba(11,14,20,.6) 70%,transparent);backdrop-filter:blur(10px);z-index:5}
  .wrap{max-width:1100px;margin:0 auto;padding:24px}
  h1{font-family:Poppins,Inter;font-weight:700;letter-spacing:.5px;margin:0 0 8px}
  .sub{color:var(--muted);margin:0 0 16px}
  .controls{display:flex;gap:12px;flex-wrap:wrap}
  .pill{padding:10px 14px;background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:999px;color:var(--text);cursor:pointer}
  .pill.active{border-color:var(--accent);box-shadow:0 0 0 2px rgba(110,231,255,.2) inset}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;padding:16px 0}
  @media (max-width:960px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:640px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(145deg,var(--card),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:16px;transition:transform .25s ease, border .25s ease}
  .card:hover{transform:translateY(-4px);border-color:rgba(110,231,255,.35)}
  .row{display:flex;align-items:center;gap:12px}
  .rank{font-size:22px;font-weight:800;min-width:38px;text-align:right}
  .flag{width:24px;height:16px;border-radius:3px;object-fit:cover;border:1px solid rgba(255,255,255,.25)}
  .name{font-weight:700}
  .badge{margin-left:auto;padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.15);color:var(--muted)}
  .level{font-size:12px;font-weight:700;letter-spacing:.3px}
  .level.Gold{color:var(--gold)} .level.Silver{color:var(--silver)} .level.Bronze{color:var(--bronze)}
  .metrics{display:flex;gap:16px;margin-top:10px;color:var(--muted);font-size:14px}
  .bar{height:8px;background:rgba(255,255,255,.08);border-radius:99px;overflow:hidden;margin-top:10px}
  .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#8ef3ff)}
  .toprow{display:flex;gap:14px;flex-wrap:wrap;margin-top:8px}
  .kpi{flex:1;min-width:180px;padding:14px;border-radius:16px;background:var(--glass);border:1px solid rgba(255,255,255,.08)}
  .kpi .title{color:var(--muted);font-size:12px}
  .kpi .value{font-weight:800;font-size:22px}
  .cta{display:flex;gap:12px;margin-top:12px}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:var(--card);cursor:pointer}
  .btn.primary{border-color:var(--accent)}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<header><div class="wrap">
  <h1>ğŸ† Global Partner Leaderboard</h1>
  <p class="sub">Real-time rankings, levels, and payout readiness â€” welcome to the Alphine AI partner arena.</p>
  <div class="controls">
    <button class="pill active" data-scope="all">All time</button>
    <button class="pill" data-scope="month">This month</button>
    <button class="pill" data-scope="week">This week</button>
  </div>
</div></header>

<main class="wrap">
  <section class="toprow">
    <div class="kpi"><div class="title">Total Partners</div><div class="value" id="kpiPartners">â€”</div></div>
    <div class="kpi"><div class="title">Total Earned</div><div class="value" id="kpiEarned">â€”</div></div>
    <div class="kpi"><div class="title">Pending Payouts</div><div class="value" id="kpiPending">â€”</div></div>
  </section>

  <section class="cta">
    <button class="btn primary" id="btnRequest">Request Payout</button>
    <span class="muted" id="payoutStatus"></span>
  </section>

  <section class="grid" id="leaderboard"></section>
</main>

<script>
  // âš ï¸ Replace with a real bearer token issued by your login flow
  const BEARER = localStorage.getItem("partner_jwt") || "REPLACE_WITH_PARTNER_JWT";
  const API_BASE = location.origin; // same host

  const $board = document.getElementById('leaderboard');
  const $kpiPartners = document.getElementById('kpiPartners');
  const $kpiEarned = document.getElementById('kpiEarned');
  const $kpiPending = document.getElementById('kpiPending');
  const $payoutStatus = document.getElementById('payoutStatus');

  const pills = document.querySelectorAll('.pill');
  pills.forEach(p => p.addEventListener('click', () => {
    pills.forEach(x => x.classList.remove('active'));
    p.classList.add('active');
    loadBoard(p.dataset.scope);
  }));

  function flagURL(country) {
    const cc = (country || "US").toLowerCase();
    return `https://flagcdn.com/24x18/${cc}.png`;
  }

  function fmt(n) {
    return new Intl.NumberFormat(undefined, { style: "currency", currency: "USD", maximumFractionDigits: 2 }).format(n||0);
  }

  async function loadBoard(scope="all") {
    $board.innerHTML = "";
    try {
      const res = await fetch(`${API_BASE}/partner/leaderboard?scope=${scope}`, {
        headers: { Authorization: `Bearer ${BEARER}` }
      });
      const j = await res.json();
      if (!j.ok) throw new Error(j.error || "API error");
      const data = j.data || [];

      // KPIs
      $kpiPartners.textContent = data.length;
      const sumEarned = data.reduce((a,b)=>a+(b.earned||0),0);
      const sumPending = data.reduce((a,b)=>a+(b.pending||0),0);
      $kpiEarned.textContent = fmt(sumEarned);
      $kpiPending.textContent = fmt(sumPending);

      data.forEach(row => {
        const pct = Math.min(100, Math.round((row.earned || 0) / (data[0]?.earned || 1) * 100));
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <div class="row">
            <div class="rank">#${row.rank}</div>
            <img class="flag" src="${flagURL(row.country)}" alt="">
            <div>
              <div class="name">${row.partner_name}</div>
              <div class="level ${row.level}">${row.level} Â· ${row.referrals} referrals</div>
            </div>
            <div class="badge">${row.badge || ""}</div>
          </div>
          <div class="metrics">
            <div>ğŸ’° Earned: <b>${fmt(row.earned)}</b></div>
            <div>ğŸª™ Redeemed: <b>${fmt(row.redeemed)}</b></div>
            <div>â³ Pending: <b>${fmt(row.pending)}</b></div>
          </div>
          <div class="bar"><span style="width:${pct}%;"></span></div>
        `;
        $board.appendChild(div);
      });

      // Confetti for #1 (lightweight)
      if (data[0] && scope === "all") {
        console.log("ğŸ‰ Congrats", data[0].partner_name);
      }
    } catch (e) {
      console.error(e);
      $board.innerHTML = `<div class="muted">Failed to load leaderboard: ${e.message}</div>`;
    }
  }

  document.getElementById('btnRequest').addEventListener('click', async () => {
    try {
      const amount = prompt("Enter payout amount (minimum 50):");
      if (!amount) return;
      const method = prompt("Preferred method (e.g., Wise, Stripe, Bank):") || "unspecified";
      const res = await fetch(`${API_BASE}/partner/payouts/request`, {
        method: "POST",
        headers: { "Content-Type": "application/json", Authorization: `Bearer ${BEARER}` },
        body: JSON.stringify({ amount: Number(amount), method })
      });
      const j = await res.json();
      if (!j.ok) throw new Error(j.error || "Request failed");
      $payoutStatus.textContent = `Payout requested â€” ticket #${j.payout.id}`;
      loadBoard(document.querySelector('.pill.active').dataset.scope);
    } catch (e) {
      $payoutStatus.textContent = `Error: ${e.message}`;
    }
  });

  loadBoard("all");
</script>
<script src="/dashboard/brand.js"></script>

</body>
</html>
